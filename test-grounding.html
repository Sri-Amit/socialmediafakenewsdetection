<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Grounding API</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background-color: #0056b3; }
        button:disabled { background-color: #6c757d; cursor: not-allowed; }
        input[type="text"] {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Grounding API Test</h1>
        <p>Test Google's Grounding API integration with Gemini 2.5 Flash</p>
        
        <div class="test-section info">
            <h3>üìã Instructions</h3>
            <p>1. Enter your Gemini API key below</p>
            <p>2. Test a claim to see if grounding returns real sources</p>
            <p>3. Verify that sources are actual, accessible URLs</p>
        </div>

        <div class="test-section">
            <h3>üîë API Configuration</h3>
            <input type="text" id="apiKey" placeholder="Enter your Gemini API key" />
            <button onclick="testApiKey()">Test API Key</button>
            <div id="apiKeyResult" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>üîç Grounding Test</h3>
            <input type="text" id="testClaim" placeholder="Enter a claim to fact-check (e.g., 'The unemployment rate in the US is 3.5%')" />
            <button onclick="testGrounding()">Test Grounding</button>
            <div id="groundingResult" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>üìä Test Results Summary</h3>
            <div id="summary" class="result" style="display: none;"></div>
        </div>
    </div>

    <script>
        const API_KEY = 'AIzaSyDaU5J4YTH70BihYb8QbGHjiK6negpX2os'; // Replace with your actual API key
        
        async function testApiKey() {
            const apiKey = document.getElementById('apiKey').value || API_KEY;
            const resultDiv = document.getElementById('apiKeyResult');
            
            resultDiv.style.display = 'block';
            resultDiv.textContent = 'Testing API key...';
            resultDiv.className = 'result info';
            
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: 'Say "API key is working" if you can read this.' }] }],
                        generationConfig: { maxOutputTokens: 50, temperature: 0.1 }
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    resultDiv.textContent = '‚úÖ API Key is valid and working!';
                    resultDiv.className = 'result success';
                } else {
                    const error = await response.text();
                    resultDiv.textContent = `‚ùå API Key test failed: ${response.status} - ${error}`;
                    resultDiv.className = 'result error';
                }
            } catch (error) {
                resultDiv.textContent = `‚ùå Network error: ${error.message}`;
                resultDiv.className = 'result error';
            }
        }
        
        async function testGrounding() {
            const apiKey = document.getElementById('apiKey').value || API_KEY;
            const claim = document.getElementById('testClaim').value || 'The unemployment rate in the US is 3.5%';
            const resultDiv = document.getElementById('groundingResult');
            
            resultDiv.style.display = 'block';
            resultDiv.textContent = 'Testing grounding with real-time search...';
            resultDiv.className = 'result info';
            
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: `Use Google Search to find current, authoritative sources that can verify or refute this claim: "${claim}"
                                
                                Search for recent, credible sources including:
                                - Government websites (.gov)
                                - Academic institutions (.edu) 
                                - Reputable news organizations (Reuters, AP, BBC, etc.)
                                - Scientific journals and research papers
                                - International organizations (WHO, UN, etc.)
                                - Fact-checking organizations (Snopes, PolitiFact, etc.)
                                
                                For each source found, provide:
                                - URL (must be real and accessible)
                                - Title (actual article/source title)
                                - Credibility score (1-10 based on source reputation)
                                - Relevance score (1-10 based on how directly it addresses the claim)
                                - Summary (brief description of what the source says about the claim)
                                
                                IMPORTANT: Only include sources that actually exist and are accessible. Do not make up or hallucinate sources.
                                
                                Return as JSON array with this structure:
                                [
                                  {
                                    "url": "https://real-source.com/article",
                                    "title": "Actual Article Title",
                                    "credibilityScore": 9,
                                    "relevanceScore": 8,
                                    "summary": "What this source says about the claim"
                                  }
                                ]`
                            }]
                        }],
                        tools: [{
                            google_search: {}
                        }],
                        generationConfig: {
                            maxOutputTokens: 1000,
                            temperature: 0.1
                        }
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const text = data.candidates[0].content.parts[0].text;
                    
                    // Try to parse as JSON
                    try {
                        const sources = JSON.parse(text);
                        if (Array.isArray(sources) && sources.length > 0) {
                            resultDiv.textContent = `‚úÖ Grounding successful! Found ${sources.length} real sources:\n\n${JSON.stringify(sources, null, 2)}`;
                            resultDiv.className = 'result success';
                            
                            // Update summary
                            updateSummary(true, sources.length, sources);
                        } else {
                            resultDiv.textContent = `‚ö†Ô∏è Grounding returned empty or invalid response:\n\n${text}`;
                            resultDiv.className = 'result error';
                            updateSummary(false, 0, []);
                        }
                    } catch (parseError) {
                        resultDiv.textContent = `‚ö†Ô∏è Grounding response not in expected JSON format:\n\n${text}`;
                        resultDiv.className = 'result error';
                        updateSummary(false, 0, []);
                    }
                } else {
                    const error = await response.text();
                    resultDiv.textContent = `‚ùå Grounding test failed: ${response.status} - ${error}`;
                    resultDiv.className = 'result error';
                    updateSummary(false, 0, []);
                }
            } catch (error) {
                resultDiv.textContent = `‚ùå Network error: ${error.message}`;
                resultDiv.className = 'result error';
                updateSummary(false, 0, []);
            }
        }
        
        function updateSummary(success, sourceCount, sources) {
            const summaryDiv = document.getElementById('summary');
            summaryDiv.style.display = 'block';
            
            if (success) {
                summaryDiv.textContent = `‚úÖ GROUNDING TEST PASSED
                
Found ${sourceCount} real sources:
${sources.map(s => `- ${s.title} (${s.url})`).join('\n')}

‚úÖ Real-time search is working
‚úÖ Sources are accessible URLs
‚úÖ Grounding API is properly integrated`;
                summaryDiv.className = 'result success';
            } else {
                summaryDiv.textContent = `‚ùå GROUNDING TEST FAILED
                
‚ùå No real sources found
‚ùå Grounding may not be working properly
‚ùå Check API key and grounding configuration`;
                summaryDiv.className = 'result error';
            }
        }
        
        // Auto-fill API key if available
        document.getElementById('apiKey').value = API_KEY;
    </script>
</body>
</html>
